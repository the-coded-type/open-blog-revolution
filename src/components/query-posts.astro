---
import PostList from "./post-list.astro";

import { getCollection } from "astro:content";

const allPosts = await getCollection("posts");

const { queryFilters, heading, nbPosts, hasCover = false, sectionHeaderContentClass } = Astro.props;

const tagFilters: string[] = [].concat( queryFilters?.tags || ["all"]);

const postFilters: string[] = [].concat( queryFilters?.posts || [""] );

const filteredByDraftStatus = allPosts.filter( post => post.data.status === 'published')

const filteredByTag = filteredByDraftStatus.filter( post =>
  tagFilters.includes("all") || post.data.tags.some( tag => tagFilters.includes(tag))
);

const filteredBySlug = filteredByTag.filter( post => { 
  const slug = post.slug;
  return !postFilters.includes(slug);
})

filteredBySlug.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const posts = nbPosts ? filteredBySlug.slice(0, nbPosts) : filteredBySlug;


---
<PostList posts={posts} heading={heading} hasCover={hasCover} titleTag='h2' descriptionTag='p' sectionHeaderContentClass={sectionHeaderContentClass}/>

